{
    "Name": "Allocation Calculation",
    "Rules": "#Region System\nFEEDSTRINGS;\nSKIPCHECK;\nUNDEFVALS;\n#EndRegion\nUNDEFVALS;\nSKIPCHECK;\nUNDEFVALS;\nFEEDSTRINGS;\n\n\n['Credit Amount']=N:IF(ATTRS('Organization',DIMNM('Organization',DIMIX('Organization',!Organization)),'Caption_Default')@=\n\t\t\tDB('Allocation Source Definition',!Allocation List,!Year,!Version,'Source Entity'),\n\t\t\t['Allocation Amount']*-1 ,0);\n\n['Allocated Amount']=N:['Allocation Amount']*['Ratio'];\n\n['Total Driver']=['Total Company','Driver'];\n\n['Driver','Q1']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='FTE',['Driver','Mar'],CONTINUE);\n['Driver','Q2']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='FTE',['Driver','Jun'],CONTINUE);\n['Driver','Q3']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='FTE',['Driver','Sep'],CONTINUE);\n['Driver','Q4']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='FTE',['Driver','Dec'],CONTINUE);\n['Driver','Year']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='FTE',['Driver','Dec'],CONTINUE);\n\n['Driver','Q1']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Square Footage',['Driver','Mar'],CONTINUE);\n['Driver','Q2']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Square Footage',['Driver','Jun'],CONTINUE);\n['Driver','Q3']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Square Footage',['Driver','Sep'],CONTINUE);\n['Driver','Q4']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Square Footage',['Driver','Dec'],CONTINUE);\n['Driver','Year']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Square Footage',['Driver','Dec'],CONTINUE);\n\n['Driver','Q1']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Server Space',['Driver','Mar'],CONTINUE);\n['Driver','Q2']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Server Space',['Driver','Jun'],CONTINUE);\n['Driver','Q3']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Server Space',['Driver','Sep'],CONTINUE);\n['Driver','Q4']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Server Space',['Driver','Dec'],CONTINUE);\n['Driver','Year']=IF(DB('Allocation Calculation',!organization,!Allocation List,!Year,!Month,!Version,'Allocation Driver')@='Server Space',['Driver','Dec'],CONTINUE);\n\n['Driver']=N:IF(SUBST(DB('Allocation Calculation',!Organization,!Allocation List,!Year,'Year',!Version,'Exclude Entity'),1,1)@='Y',0,\nDB('Income Statement','Base',!Organization,!Year,!Month,DB('Allocation Source Definition',!Allocation List,!Year,!Version,'Allocation Driver'),!Version) );\n\n['Exclude Entity']=S:IF(ATTRS('Organization',DIMNM('Organization',DIMIX('Organization',!Organization)),'Caption_Default')@=\n\t\t\tDB('Allocation Source Definition',!Allocation List,!Year,!Version,'Source Entity'),\n\t\t\t'Y',STET);\n\n['Allocation Amount']= DB('Income Statement','Base',DB('Allocation Source Definition',!Allocation List,!Year,!Version,'Source Entity'),!Year,!Month,DB('Allocation Source Definition',!Allocation List,!Year,!Version,'Source Account'),!Version)\n                                   * DB('Allocation Source Definition',!Allocation List,!Year,!Version,'Pct to Allocate');\n\n\n\n#[{'Source Entity','Source Account','Allocation Driver'}] = S: DB('Allocation Source Definition',!Allocation List,!Year,!Version,!Allocation Calculation);\n\n#Region N-Calculation rules: Dimension:Allocation Calculation\n#Autogenerated CALC NUMERIC 416C6C6F636174696F6E2043616C63756C6174696F6E\n   #Region Dimension:Allocation Calculation, Member:Ratio\n   #Autogenerated MEMBERCALC NUMERIC 5B416C6C6F636174696F6E2043616C63756C6174696F6E5D2E5B526174696F5D\n   ['Allocation Calculation':'Ratio']=N:(['Allocation Calculation':'Driver']\\['Allocation Calculation':'Total Driver']);\n   #EndRegion\n   #Region Dimension:Allocation Calculation, Member:Allocated Amount\n   #Autogenerated MEMBERCALC NUMERIC 5B416C6C6F636174696F6E2043616C63756C6174696F6E5D2E5B416C6C6F636174656420416D6F756E745D\n   ['Allocation Calculation':'Allocated Amount']=N:(['Allocation Calculation':'Allocation Amount']*['Allocation Calculation':'Ratio']);\n   #EndRegion\n#EndRegion\n\n#Region Link rule: Allocation Calculation:Allocation Source Definition - String\n#Source cube: Allocation Source Definition\n#Target cube: Allocation Calculation\n#Autogenerated LINK STRING 7D4C696E6B5F416C6C6F636174696F6E2043616C63756C6174696F6E5F3341416C6C6F636174696F6E20536F7572636520446566696E6974696F6E\n['Allocation Calculation':{'Allocation Driver','Source Entity','Source Account'}] = S:DB('Allocation Source Definition',\n    !Allocation List, !Year, !Version, ATTRS('Allocation Calculation',\n    !Allocation Calculation, '}Map_}Link_Allocation Calculation_3AAllocation Source Definition'));\n#EndRegion\n\n#Region C-Calculation rules: Dimension:Allocation Calculation\n#Autogenerated CALC CONSOLIDATED 416C6C6F636174696F6E2043616C63756C6174696F6E\n   #Region Dimension:Allocation Calculation, Member:Ratio\n   #Autogenerated MEMBERCALC CONSOLIDATED 5B416C6C6F636174696F6E2043616C63756C6174696F6E5D2E5B526174696F5D\n   ['Allocation Calculation':'Ratio']=C:(['Allocation Calculation':'Driver']\\['Allocation Calculation':'Total Driver']);\n   #EndRegion\n#EndRegion\n\nFEEDERS;\n\n['Driver']=>['Ratio'];\n['Allocation Amount']=>['Allocated Amount'],['Total Driver'];\n['Allocation Amount']=>DB(IF(ATTRS('Organization',DIMNM('Organization',DIMIX('Organization',!Organization)),'Organization Description')@=\n\t\t\tDB('Allocation Source Definition',!Allocation List,!Year,!Version,'Source Entity'),'Allocation Calculation',''),!Organization,!Allocation List,!Year,!Month,!Version,'Exclude Entity');\n['Exclude Entity']=>['Credit Amount'];\n\n\n\n\n#Region FEED The Income Statement\n['Credit Amount']=>DB(IF(ATTRS('Version',!Version,'Version Type') @= 'B' %\n                        ATTRS('Version',!Version,'Version Type') @= 'A' %\n                        ATTRS('Version',!Version,'Version Type') @= 'T'\n                   ,'Income Statement',''), 'Local', !organization,!Year, !Month, '6610', !Version);\n['Allocated Amount']=>DB(IF(ATTRS('Version',!Version,'Version Type') @= 'B' %\n                        ATTRS('Version',!Version,'Version Type') @= 'A' %\n                        ATTRS('Version',!Version,'Version Type') @= 'T'\n                      ,'Income Statement',''), 'Local', !organization,!Year, !Month, '6600', !Version);\n#EndRegion"
}