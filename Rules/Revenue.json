{
    "Name": "Revenue",
    "Rules": "#Region System\nFEEDSTRINGS;\nSKIPCHECK;\nUNDEFVALS;\nUNDEFVALS;\n#EndRegion\n\n#Region Year on Year Variances\n['Y2-Y1 %' ] =  (['Y2 - Y1 $']\\['Y1'])*100;\n['Y2-Y1 $' ] =  IF(attrn('Revenue',!Revenue,'signswitch')=0,['Y1']-['Y2'],['Y2']-['Y1']);\n#EndRegion\n\n#Region Rate and Volume Variances\n['Gross Revenue','Volume Variance']= N:(DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), 'Units Sold') -\n\tDB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Current Version', 'String'), 'Units Sold'))*\n\tDB('Revenue Assumptions', !product, !Channel, !Month, !Year, DB('Calendar', 'Current Version', 'String'), 'Unit Price');\n['Gross Revenue','Rate Variance']= N:(DB('Revenue Assumptions', !product, !Channel, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), 'Unit Price') -\n\tDB('Revenue Assumptions', !product, !Channel, !Month, !Year, DB('Calendar', 'Current Version', 'String'), 'Unit Price')) *\n\tDB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), 'Units Sold');\n#EndRegion\n\n#Region Variances\n['Variance']=if(attrn('Revenue',!Revenue,'signswitch')=0,\n          (DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Current Version', 'String'), !Revenue)-DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), !Revenue))* ATTR\nN('Version',DB('Calendar', 'Compare Against', 'String'),'VarianceFactor'),\n          (DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), !Revenue)-DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Current Version', 'String'), !Revenue))* ATTR\nN('Version',DB('Calendar', 'Compare Against', 'String'),'VarianceFactor')\n          );\n['Variance%']=['Variance']\\DB('Revenue', !organization, !Channel, !product, !Month, !Year,DB('Calendar', 'Current Version', 'String') , !Revenue)*100;\n#EndRegion\n\n#Region Target vs Prior Year Actual\n['Target vs Prior Year Actual']=if(attrn('Revenue',!Revenue,'signswitch')=0,['Target']-['Prior Year Actual'],['Prior Year Actual']-['Target'])*-1;\n['Target vs Prior Year Actual %']=(['Target vs Prior Year Actual']\\RoundP(['Prior Year Actual'],0))*100;\n#EndRegion\n#Region Prior Year Actual\n['Prior Year Actual'] = n: DB('Revenue', !organization, !Channel, !product, !Month, ATTRS('Year',!Year,'Prev'), 'Actual', !Revenue);\n#EndRegion\n\n['Gross Margin %']=c: (['Gross Margin']\\['Gross Revenue'])*100;\n['Unit Price'] = c: ['Gross Revenue']\\['Units Sold'];\n['Unit Cost'] = c: ['Cost of Sales']\\['Units Sold'];\n\n#Region Get Version for Dashboard\n['Dashboard'] = n: DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Current Version', 'String'), !Revenue);\n['DashboardCA'] = n: DB('Revenue', !organization, !Channel, !product, !Month, !Year, DB('Calendar', 'Compare Against', 'String'), !Revenue);\n#EndRegion\n\n['Gross Revenue']=n:['Units Sold']*['Unit Price'];\n['Direct COGS']=n:DB('Supply Chain', !organization, !Channel, !product, !Month, !Year, 'Direct Costs', !Version);\n['Indirect COGS']=n:IF(DB('Supply Chain', !organization, !Channel, !product, !Month, !Year, 'Units Sold', !Version)<>0,DB('Supply Chain', !organization, !Channel, !product, !Month, !Year, 'Indirect Costs', !Version),CONTINUE);\n\n#['Unit Cost']=n:db('Revenue Assumptions',!Product,!Channel,!Month, !Year, !Version, 'Unit Cost');\n['Unit Cost' ] = n: DB('Rate BOM', !Month, ATTRS('organization', !organization, 'Default Plant'), !product, 'Total Local BOM', !Year, !Version);\n['Unit Price']=n:db('Revenue Assumptions',!Product,!Channel,!Month, !Year, !Version, 'Unit Price');\n\n#Region C-Calculation rules: Dimension:Revenue\n#Autogenerated CALC CONSOLIDATED 526576656E7565\n   #Region Dimension:Revenue, Member:Unit Cost\n   #Autogenerated MEMBERCALC CONSOLIDATED 5B526576656E75655D2E5B556E697420436F73745D\n   #@AutoGenerated\n   #['Revenue':{'Unit Cost'}]=C:IF(DTYPE('Month', !Month)@='C',\n   #ConsolidateChildren('Month')\\ELCOMPN('Month', !Month),\n   #CONTINUE);\n   #EndRegion\n#EndRegion\n\nFEEDERS;\n['Units Sold']=>['Unit Cost'],['Unit Price'],['Gross Revenue'],['Direct COGS' ],['Indirect COGS'] ;\n\n#Region Year on Year Variances\n[{'Y1','Y2'}]=> ['Y2-Y1 $'];\n['Y2-Y1 $']=> ['Y2-Y1 %'];\n#EndRegion\n\n#Region Variance Calculation\n#['Units Sold']=>DB(IF(DIMNM('Version', DIMIX('Version', !Version))@=DB('Calendar', 'Current Version', 'String'),'Revenue',''), !organization, !Channel, !product, !Month, !Year, 'Variance', !Revenue);\n['Actual']=>['Variance'];\n['Variance']=>['Variance%'];\n#EndRegion\n\n#Region Prior Year Actual\n['Actual'] => DB('Revenue', !organization, !Channel, !product, !Month, ATTRS('Year',!Year,'Next'), 'Prior Year Actual', !Revenue);\n#EndRegion\n\n#Region Dashboard Version\n#['Units Sold']=>DB(IF(DIMNM('Version', DIMIX('Version', !Version))@=DB('Calendar', 'Current Version', 'String'),'Revenue',''),!organization, !Channel, !product, !Month, !Year, 'Dashboard', 'Units Sold');\n#['Units Sold']=>DB(IF(DIMNM('Version', DIMIX('Version', !Version))@=DB('Calendar', 'Compare Against', 'String'),'Revenue',''),!organization, !Channel, !product, !Month, !Year, 'DashboardCA', 'Units Sold');\n['Budget']=>['Dashboard'];\n['Budget']=>['DashboardCA'];\n#EndRegion\n\n#Region Target vs Prior Year Actual\n['Prior Year Actual']=>['Target vs Prior Year Actual'],['Target vs Prior Year Actual %'];\n['Target']=>['Target vs Prior Year Actual'],['Target vs Prior Year Actual %'];\n#EndRegion\n\n#Region Rate and Volume Variance Feeders\n['Units Sold']=>['Volume Variance'],['Rate Variance'];\n['Unit Price']=>['Volume Variance'],['Rate Variance'];\n#EndRegion\n\n#REGION Feed Units Sold to Supply Chain Cube\n#['Units Sold' ]  => DB('Supply Chain', !organization, !Channel, !product, !Month, !Year,!Revenue,!Version);\n#ENDREGION\n\n#Region Automatically generated feeders\n#Autogenerated AUTOFEEDERS\n['Channel':'Channel Total', 'Version':'Dashboard'] => DB('Revenue Metrics', !organization, !Year, !Month, !Revenue, \n    !product, 'Target');\n['Channel':'Channel Total', 'Version':'DashboardCA'] => DB('Revenue Metrics', !organization, !Year, !Month, !Revenue, \n    !product, 'Actual');\n['Channel':'Channel Total', 'Version':'Forecast'] => DB('Revenue Metrics', !organization, !Year, !Month, !Revenue, \n    !product, 'Forecast');\n#EndRegion"
}